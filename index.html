<!DOCTYPE html>
<html lang="en">
    <style type="text/css">

    svg{
      padding: 30px;
    }

      .yaxis path,

      .yaxis line {
          fill: none;
          stroke: black;
          shape-rendering: crispEdges;
      }

      .xaxis path,

      .xaxis line {
          fill: none;
          stroke: black;
          shape-rendering: crispEdges;
        }

</style>

<head>
    <meta charset="utf-8">

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

</head>

<body>

<script type="text/javascript">


var margin = {top: 20, right: 20, bottom: 20, left: 20};
     width = 960 - margin.left - margin.right,
     height = 700 - margin.top - margin.bottom;

var html = d3.select("body");

d3.csv("dataclean.csv", function(error, data){

  var buttonGroup = html.append("div");

  var button1 = buttonGroup.append("button")
    .text("button1")
    .on("click", function() {
      draw("1500m Men")
    })

  var button2 = buttonGroup.append("button")
    .text("button2")
    .on("click", function() {
      draw("500m Men")
    })

  var svg = html.append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  data.forEach(function(d) { 
    d.Year = +d.Year,
    d.Altitude = +d.Altitude,
    d.totalseconds = +d.totalseconds
  });

  var xScale = d3.scale.linear()
      .domain([1920, 2014])
      .range([0, width]);

  var yScale = d3.scale.linear()
      .range([0, height]);

  var dataByEvent = d3.nest()
      .key(function(d) { return d.Event; })
      .map(data);

  var xAxis = d3.svg.axis()
    .scale(xScale)
    .tickFormat(d3.format("d"))
    .tickValues([1924, 1928, 1932, 1936, 1948, 1952, 1956, 1960, 1964, 1968, 1972, 1976, 1980, 1984, 1988, 1992, 1994, 1998, 2002, 2006, 2010, 2014]);

  svg.append("g")
      .attr("class", "xaxis")  //Assign "xaxis" class
      .call(xAxis)
      .attr("transform", "translate(0," + (height) + ")");

  var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left");

  svg.append("g")
      .attr("class", "yaxis")
      .call(yAxis);


  function draw(currentEvent) {
    console.log(currentEvent);

    var currentEventData = dataByEvent[currentEvent];

    yScale.domain([d3.min(currentEventData, function(d) { return d.totalseconds}), d3.max(currentEventData, function(d) { return d.totalseconds})]);

    var circles = svg.selectAll("circle")
        .data(currentEventData)

    circles.enter()
        .append("circle");

    circles.exit()
        .remove();
        
    circles.transition()
        .attr('r', "5")
        .attr('cx', function(d){ return xScale(d.Year); })
        .attr('cy', function(d){ return height - yScale(d.totalseconds); })
        .attr('fill', 'orange')
        .attr('stroke', 'darkgray');

    console.log(currentEventData)
  }

});

</script>
</body>
